<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: RubyWiki</title>

	<link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

	<script src="./js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="./init_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="init.rb">init.rb</a></li>
					
						<li><a href="./query_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="query.rb">query.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">Object</p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-new">::new</a></li>
					
					<li><a href="#method-i-exception">#exception</a></li>
					
					<li><a href="#method-i-finalize">#finalize</a></li>
					
					<li><a href="#method-i-get_api">#get_api</a></li>
					
					<li><a href="#method-i-init_curl%21">#init_curl!</a></li>
					
					<li><a href="#method-i-log">#log</a></li>
					
					<li><a href="#method-i-login%21">#login!</a></li>
					
					<li><a href="#method-i-post_api">#post_api</a></li>
					
					<li><a href="#method-i-urldecode">#urldecode</a></li>
					
					<li><a href="#method-i-urlencode">#urlencode</a></li>
					
					<li><a href="#method-i-wiki_info">#wiki_info</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="./RubyWiki.html">RubyWiki</a></li>
				
					<li><a href="./RubyWikiError.html">RubyWikiError</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">RubyWiki</h1>

		<div id="description">
			<p>
This is the main <a href="RubyWiki.html">RubyWiki</a> class, it contains
all you need to perform actions on a wiki. All requests are done with API
and YAML (built-in version in the standard library)
</p>

		</div>

		<!-- Constants -->
		
		<div id="constants-list" class="section">
			<h3 class="section-header">Constants</h3>
			<dl>
			
				<dt><a name="LL_DEBUG">LL_DEBUG</a></dt>
				
				<dd class="description"><p>
Debug Information Log Level, e.g.
</p>
<ul>
<li><p>
<a href="RubyWiki.html">RubyWiki</a> Started
</p>
</li>
<li><p>
OS: Microsoft Windows 7 Ultimate Edition
</p>
</li>
<li><p>
Ruby Version 1.9.2-p180
</p>
</li>
</ul></dd>
				
			
				<dt><a name="LL_INFO">LL_INFO</a></dt>
				
				<dd class="description"><p>
Information Log Level, e.g.
</p>
<ul>
<li><p>
User &#8220;foo&#8221; logged into wiki &#8220;bar&#8221;
</p>
</li>
</ul></dd>
				
			
				<dt><a name="LL_NOTICE">LL_NOTICE</a></dt>
				
				<dd class="description"><p>
Notice Log Level, any information that have more powerful meaning that
normal information
</p></dd>
				
			
				<dt><a name="LL_WARN">LL_WARN</a></dt>
				
				<dd class="description"><p>
Warning Log Level, errors that happened but <a
href="RubyWiki.html">RubyWiki</a> can handle it
</p></dd>
				
			
				<dt><a name="LL_ERROR">LL_ERROR</a></dt>
				
				<dd class="description"><p>
Error Log Level, any error that can be caught with rescue
</p></dd>
				
			
				<dt><a name="LL_FATAL">LL_FATAL</a></dt>
				
				<dd class="description"><p>
Fatal Error Log Level, any error that exits immediately
</p></dd>
				
			
				<dt><a name="EOL">EOL</a></dt>
				
				<dd class="description"><p>
End of line
</p></dd>
				
			
			</dl>
		</div>
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="new-method" class="method-detail ">
				<a name="method-c-new"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">(wiki = nil, user = nil, pass = nil, agent = nil, max_lag = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Initialize the whole class, populate class variables with data and login.
</p>
<table>
<tr><td valign="top">Wiki</td><td><p>
The wiki specification to load
</p>
</td></tr>
<tr><td valign="top">User</td><td><p>
The user to use for that wiki
</p>
</td></tr>
<tr><td valign="top">Agent</td><td><p>
The User-Agent to use
</p>
</td></tr>
<tr><td valign="top">max_lag</td><td><p>
Importance of data so MediaWiki knows how to adjust slave DBs to prevent
lag
</p>
</td></tr>
</table>
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 61</span>
 61:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">wiki</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">pass</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">agent</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">max_lag</span> = <span class="ruby-keyword kw">nil</span>)
 62:                 <span class="ruby-comment cmt"># Read Configuration file defined in &quot;initrbw.rb&quot;</span>
 63:                 <span class="ruby-ivar">@conf</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_file</span> <span class="ruby-constant">ConfigFile</span>
 64:                 <span class="ruby-comment cmt"># Get the wiki name to use, from the argument if defined or the configuration</span>
 65:                 <span class="ruby-ivar">@wikid</span> = <span class="ruby-identifier">wiki</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">wiki</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'wiki'</span>]
 66: 
 67:                 <span class="ruby-comment cmt"># Load the wiki's configuration</span>
 68:                 <span class="ruby-keyword kw">begin</span>
 69:                         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">readable?</span>(<span class="ruby-constant">ConfigDir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'wikis/'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@wikid</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.yaml'</span>)
 70:                                 <span class="ruby-ivar">@wikiconf</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_file</span>(<span class="ruby-constant">ConfigDir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'wikis/'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@wikid</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.yaml'</span>)
 71:                         <span class="ruby-keyword kw">else</span>
 72:                                 <span class="ruby-ivar">@wikiconf</span> = <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_file</span>(<span class="ruby-constant">INC</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'../wikis/'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@wikid</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'.yaml'</span>)
 73:                         <span class="ruby-keyword kw">end</span>
 74:                 <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span>
 75:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyWikiError</span>, <span class="ruby-value str">'12 Invalid Wiki Config'</span>
 76:                 <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
 77:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyWikiError</span>, <span class="ruby-value str">'13 Wiki doesn\t exist'</span>
 78:                 <span class="ruby-keyword kw">end</span>
 79:                 
 80:                 <span class="ruby-comment cmt"># Get Wiki Data</span>
 81:                 <span class="ruby-comment cmt"># Wiki Name</span>
 82:                 <span class="ruby-ivar">@wikiname</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'name'</span>]
 83:                 <span class="ruby-comment cmt"># Replicate DB lag level</span>
 84:                 <span class="ruby-ivar">@max_lag</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'maxlag'</span>]
 85:                 <span class="ruby-comment cmt"># Edit per minute</span>
 86:                 <span class="ruby-ivar">@epm</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'epm'</span>]
 87:                 <span class="ruby-comment cmt"># Wiki Protocol</span>
 88:                 <span class="ruby-ivar">@proto</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'protocol'</span>]
 89:                 <span class="ruby-comment cmt"># Wiki Domain</span>
 90:                 <span class="ruby-ivar">@host</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'domain'</span>]
 91:                 <span class="ruby-comment cmt"># Path to wiki installation directory relative to @host</span>
 92:                 <span class="ruby-ivar">@path</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'path'</span>]
 93:                 <span class="ruby-comment cmt"># Article Path relative to @host</span>
 94:                 <span class="ruby-ivar">@article</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'article'</span>]
 95:                 <span class="ruby-comment cmt"># API.php filename</span>
 96:                 <span class="ruby-ivar">@api_script</span> = <span class="ruby-ivar">@wikiconf</span>[<span class="ruby-value str">'api'</span>]
 97:                 <span class="ruby-comment cmt"># End of Get Wiki Data</span>
 98:                 
 99:                 <span class="ruby-comment cmt"># Merge wiki configuration to make the absolute URL to API.php</span>
100:                 <span class="ruby-ivar">@api_url</span> = <span class="ruby-ivar">@proto</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'://'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@host</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@path</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'/'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@api_script</span>
101:                 <span class="ruby-comment cmt"># Generate the User-Agent of the Bot</span>
102:                 <span class="ruby-ivar">@useragent</span> = <span class="ruby-identifier">agent</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">agent</span> <span class="ruby-operator">:</span> (
103:                         <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'useragent'</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'default'</span> <span class="ruby-operator">?</span>
104:                                 <span class="ruby-value str">'RubyWiki/'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">RBW_VERSION</span> <span class="ruby-operator">:</span>
105:                                 <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'useragent'</span>]
106:                         )
107:                 <span class="ruby-comment cmt"># Figure out the log level</span>
108:                 <span class="ruby-ivar">@loglevel</span> = <span class="ruby-constant">RubyWiki</span><span class="ruby-operator">::</span><span class="ruby-identifier">const_get</span>(<span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'loglevel'</span>])
109:                 
110:                 <span class="ruby-comment cmt"># Username and password</span>
111:                 <span class="ruby-comment cmt"># Get the username to use, from the argument if defined or the configuration</span>
112:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>
113:                         <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">user</span>
114:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'user'</span>]
115:                         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'users'</span>][<span class="ruby-ivar">@wikid</span>].<span class="ruby-identifier">include?</span><span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'user'</span>]
116:                                 <span class="ruby-ivar">@user</span> = <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'user'</span>]
117:                         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'users'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-value">0</span>]
118:                                 <span class="ruby-ivar">@user</span> = <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'users'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-value">0</span>]
119:                         <span class="ruby-keyword kw">else</span>
120:                                 <span class="ruby-identifier">exception</span> <span class="ruby-constant">RubyWikiError</span>, <span class="ruby-value">11</span>, <span class="ruby-value str">'No Such User'</span>
121:                         <span class="ruby-keyword kw">end</span>
122:                 <span class="ruby-keyword kw">else</span>
123:                         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'users'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-value">0</span>]
124:                                 <span class="ruby-ivar">@user</span> = <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'users'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-value">0</span>]
125:                         <span class="ruby-keyword kw">else</span>
126:                                 <span class="ruby-identifier">exception</span> <span class="ruby-constant">RubyWikiError</span>, <span class="ruby-value">11</span>, <span class="ruby-value str">'No Such User'</span>
127:                         <span class="ruby-keyword kw">end</span>
128:                 <span class="ruby-keyword kw">end</span>
129:                 <span class="ruby-comment cmt"># Get password</span>
130:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pass</span>
131:                         <span class="ruby-ivar">@pass</span> = <span class="ruby-identifier">pass</span>
132:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'pass'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-ivar">@user</span>]
133:                         <span class="ruby-ivar">@pass</span> = <span class="ruby-ivar">@conf</span>[<span class="ruby-value str">'pass'</span>][<span class="ruby-ivar">@wikid</span>][<span class="ruby-ivar">@user</span>]
134:                 <span class="ruby-keyword kw">else</span>
135:                         <span class="ruby-identifier">require</span> <span class="ruby-value str">'highline/import'</span>
136:                         <span class="ruby-ivar">@pass</span> = <span class="ruby-identifier">ask</span>(<span class="ruby-node">&quot;Type in the password for #{@user}@#{@wikiname}:&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">echo</span> = <span class="ruby-value str">&quot;*&quot;</span> }
137:                 <span class="ruby-keyword kw">end</span>
138:                 <span class="ruby-comment cmt"># End of Username and password</span>
139:                 
140:                 <span class="ruby-comment cmt"># Open up a temperory file for cURL cookies</span>
141:                 <span class="ruby-ivar">@temp_handle</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'RubyWiki-cookie'</span>) <span class="ruby-comment cmt"># create</span>
142:                 <span class="ruby-ivar">@temp</span> = <span class="ruby-ivar">@temp_handle</span>.<span class="ruby-identifier">path</span> <span class="ruby-comment cmt"># Get path</span>
143:                 <span class="ruby-ivar">@temp_handle</span>.<span class="ruby-identifier">close</span> <span class="ruby-comment cmt"># Close handle</span>
144:                 
145:                 <span class="ruby-comment cmt"># Open the log file</span>
146:                 <span class="ruby-ivar">@log</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-constant">ConfigDir</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'rubywiki.log'</span>, <span class="ruby-value str">'a'</span>)
147:                 
148:                 <span class="ruby-comment cmt"># Max Slave DB lag level</span>
149:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">max_lag</span> 
150:                         <span class="ruby-ivar">@max_lag</span> = <span class="ruby-identifier">max_lag</span>
151:                 <span class="ruby-keyword kw">else</span>
152:                         <span class="ruby-ivar">@max_lag</span> = <span class="ruby-value">5</span>
153:                 <span class="ruby-keyword kw">end</span>
154:                 
155:                 <span class="ruby-comment cmt"># Define Destructor</span>
156:                 <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">define_finalizer</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:finalize</span>).<span class="ruby-identifier">to_proc</span>)
157:                 
158:                 <span class="ruby-comment cmt"># Initialize cURL Handles</span>
159:                 <span class="ruby-identifier">init_curl!</span>
160:                 
161:                 <span class="ruby-comment cmt"># Debug Log</span>
162:                 <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;RubyWiki/#{RBW_VERSION} started&quot;</span>, <span class="ruby-constant">LL_DEBUG</span>
163:                 <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Ruby Version #{RUBY_VERSION}-p#{RUBY_PATCHLEVEL}&quot;</span>, <span class="ruby-constant">LL_DEBUG</span>
164:                 
165:                 <span class="ruby-comment cmt"># Login</span>
166:                 <span class="ruby-identifier">login!</span>
167:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="finalize-method" class="method-detail ">
				<a name="method-i-finalize"></a>

				<div class="method-heading">
				
					<span class="method-name">finalize</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Finalizer, destory the temperory file and close the log file
</p>
					

					
					<div class="method-source-code"
						id="finalize-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 170</span>
170:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">finalize</span>
171:                 <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">close</span>
172:                 <span class="ruby-ivar">@temp_handle</span>.<span class="ruby-identifier">unlink</span>
173:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wiki-info-method" class="method-detail ">
				<a name="method-i-wiki_info"></a>

				<div class="method-heading">
				
					<span class="method-name">wiki_info</span><span
						class="method-args">(type = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="wiki-info-source">
<pre>
   <span class="ruby-comment cmt"># File query.rb, line 3</span>
3:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wiki_info</span> (<span class="ruby-identifier">type</span> = <span class="ruby-keyword kw">nil</span>)
4:                 <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">get_api</span>()
5:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="protected-instance-method-details" class="method-section section">
			<h3 class="section-header">Protected Instance Methods</h3>

		
			<div id="exception-method" class="method-detail ">
				<a name="method-i-exception"></a>

				<div class="method-heading">
				
					<span class="method-name">exception</span><span
						class="method-args">(type, code, message)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="exception-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 254</span>
254:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exception</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">code</span>, <span class="ruby-identifier">message</span>)
255:                 <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^(.+?):(\d+)(?::in `(.*)')?/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">caller</span>()[<span class="ruby-value">0</span>]
256:                         <span class="ruby-identifier">method</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>[<span class="ruby-value">3</span>]
257:                 <span class="ruby-keyword kw">end</span>
258:                 <span class="ruby-identifier">log</span>(<span class="ruby-value str">'Exception '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">' raised in &quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot;!!!'</span>, <span class="ruby-constant">LL_ERROR</span>)
259:                 <span class="ruby-identifier">raise</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">code</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">message</span>
260:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-api-method" class="method-detail ">
				<a name="method-i-get_api"></a>

				<div class="method-heading">
				
					<span class="method-name">get_api</span><span
						class="method-args">(query)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="get-api-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 222</span>
222:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_api</span>(<span class="ruby-identifier">query</span>)
223:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;#{@api_url}?#{query}&amp;maxlag=#{@max_lag}&amp;format=yaml&quot;</span>
224:                 <span class="ruby-keyword kw">begin</span>
225:                         <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">http_get</span>
226:                         <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-ivar">@get</span>.<span class="ruby-identifier">body_str</span>)
227:                 <span class="ruby-keyword kw">rescue</span>
228:                         <span class="ruby-keyword kw">false</span>
229:                 <span class="ruby-keyword kw">end</span>
230:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="init-curl--method" class="method-detail ">
				<a name="method-i-init_curl%21"></a>

				<div class="method-heading">
				
					<span class="method-name">init_curl!</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Internal 
</p>
					

					
					<div class="method-source-code"
						id="init-curl--source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 209</span>
209:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_curl!</span>
210:                 <span class="ruby-ivar">@get</span> = <span class="ruby-constant">Curl</span><span class="ruby-operator">::</span><span class="ruby-constant">Easy</span>.<span class="ruby-identifier">new</span>()
211:                 <span class="ruby-ivar">@post</span> = <span class="ruby-constant">Curl</span><span class="ruby-operator">::</span><span class="ruby-constant">Easy</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@api_url</span>)
212:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">enable_cookies</span> = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">enable_cookies</span> = <span class="ruby-keyword kw">true</span>
213:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">useragent</span>  = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">useragent</span>  = <span class="ruby-ivar">@useragent</span>
214:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">cookiejar</span> = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">cookiejar</span> = <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">cookiefile</span> = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">cookiefile</span> = <span class="ruby-ivar">@temp</span>
215:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">headers</span>    = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">headers</span>    = [
216:                         <span class="ruby-value str">'Connection: keep-alive'</span>,
217:                         <span class="ruby-value str">'Keep-Alive: 300'</span>,
218:                         ]
219:                 <span class="ruby-ivar">@get</span>.<span class="ruby-identifier">encoding</span>   = <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">encoding</span>   = <span class="ruby-value str">'gzip, deflate'</span>
220:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="log-method" class="method-detail ">
				<a name="method-i-log"></a>

				<div class="method-heading">
				
					<span class="method-name">log</span><span
						class="method-args">(data, level = LL_INFO, fmt = '%Y-%m-%d %H-%M-%S.%L')</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="log-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 246</span>
246:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">level</span> = <span class="ruby-constant">LL_INFO</span>, <span class="ruby-identifier">fmt</span> = <span class="ruby-value str">'%Y-%m-%d %H-%M-%S.%L'</span>)
247:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@loglevel</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">level</span>
248:                         <span class="ruby-identifier">write</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-identifier">fmt</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">' - '</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">data</span>
249:                         <span class="ruby-ivar">@log</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">write</span> <span class="ruby-operator">+</span> <span class="ruby-constant">EOL</span>
250:                         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">write</span>
251:                 <span class="ruby-keyword kw">end</span>
252:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="login--method" class="method-detail ">
				<a name="method-i-login%21"></a>

				<div class="method-heading">
				
					<span class="method-name">login!</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Internal method to log into the wiki
</p>
					

					
					<div class="method-source-code"
						id="login--source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 177</span>
177:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">login!</span>
178:                 <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">post_api</span>({
179:                         <span class="ruby-value str">'action'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'login'</span>,
180:                         <span class="ruby-value str">'lgname'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>,
181:                         <span class="ruby-value str">'lgpassword'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pass</span>,
182:                         })
183:                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'login'</span>][<span class="ruby-value str">'result'</span>] 
184:                         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Success'</span>
185:                                 <span class="ruby-comment cmt"># Unpatched server, all done. (See bug #23076, April 2010)</span>
186:                                 <span class="ruby-identifier">log</span> <span class="ruby-value str">'&quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot; logged into wiki &quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@wiki</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'&quot;'</span>, <span class="ruby-constant">LL_INFO</span>
187:                         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'NeedToken'</span>
188:                                 <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">post_api</span>({
189:                                         <span class="ruby-value str">'action'</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'login'</span>,
190:                                         <span class="ruby-value str">'lgname'</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>,
191:                                         <span class="ruby-value str">'lgpassword'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pass</span>,
192:                                         <span class="ruby-value str">'lgtoken'</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'login'</span>][<span class="ruby-value str">'token'</span>],
193:                                         })
194:                                 <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'login'</span>][<span class="ruby-value str">'result'</span>]
195:                                         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Success'</span>
196:                                                 <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;\&quot;#{@user}\&quot; logged into wiki \&quot;#{@wikiname}\&quot;&quot;</span>, <span class="ruby-constant">LL_INFO</span>
197:                                         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Throttled'</span>
198:                                                 <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;\&quot;#{@user}\&quot; needs to wait #{resp['login']['wait']} seconds to log into wiki \&quot;#{@wikiname}\&quot;!&quot;</span>, <span class="ruby-constant">LL_WARN</span>
199:                                                 <span class="ruby-identifier">sleep</span> <span class="ruby-identifier">resp</span>[<span class="ruby-value str">'login'</span>][<span class="ruby-value str">'wait'</span>]
200:                                                 <span class="ruby-identifier">login!</span>
201:                                         <span class="ruby-keyword kw">else</span>
202:                                                 
203:                                 <span class="ruby-keyword kw">end</span>
204:                         
205:                 <span class="ruby-keyword kw">end</span>
206:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="post-api-method" class="method-detail ">
				<a name="method-i-post_api"></a>

				<div class="method-heading">
				
					<span class="method-name">post_api</span><span
						class="method-args">(data, multipart = true, force = false)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="post-api-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 232</span>
232:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_api</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">multipart</span> = <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">force</span> = <span class="ruby-keyword kw">false</span>)
233:                 <span class="ruby-identifier">query</span> = <span class="ruby-value str">''</span>
234:                 <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span>, <span class="ruby-identifier">content</span><span class="ruby-operator">|</span>
235:                         <span class="ruby-identifier">query</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">var</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'='</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">urlencode</span>(<span class="ruby-identifier">content</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">'&amp;'</span>
236:                 <span class="ruby-keyword kw">end</span>
237:                 <span class="ruby-identifier">query</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'format=yaml'</span>
238:                 <span class="ruby-keyword kw">begin</span>
239:                         <span class="ruby-ivar">@post</span>.<span class="ruby-identifier">http_post</span> <span class="ruby-identifier">query</span>
240:                         <span class="ruby-constant">YAML</span><span class="ruby-operator">::</span><span class="ruby-identifier">load</span>(<span class="ruby-ivar">@post</span>.<span class="ruby-identifier">body_str</span>)
241:                 <span class="ruby-keyword kw">rescue</span>
242:                         <span class="ruby-keyword kw">false</span>
243:                 <span class="ruby-keyword kw">end</span>
244:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="urldecode-method" class="method-detail ">
				<a name="method-i-urldecode"></a>

				<div class="method-heading">
				
					<span class="method-name">urldecode</span><span
						class="method-args">(string)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="urldecode-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 268</span>
268:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">urldecode</span>(<span class="ruby-identifier">string</span>)
269:                 <span class="ruby-identifier">str</span>=<span class="ruby-identifier">string</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-value str">'+'</span>, <span class="ruby-value str">' '</span>).<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">ASCII_8BIT</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/((?:%[0-9a-fA-F]{2})+)/</span>) <span class="ruby-keyword kw">do</span>
270:                         [<span class="ruby-node">$1</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'%'</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'H*'</span>)
271:                 <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">'UTF-8'</span>)
272:                 <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">string</span>.<span class="ruby-identifier">encoding</span>)
273:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="urlencode-method" class="method-detail ">
				<a name="method-i-urlencode"></a>

				<div class="method-heading">
				
					<span class="method-name">urlencode</span><span
						class="method-args">(string)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="urlencode-source">
<pre>
     <span class="ruby-comment cmt"># File init.rb, line 262</span>
262:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">urlencode</span>(<span class="ruby-identifier">string</span>)
263:                 <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/([^ a-zA-Z0-9_.-]+)/</span>) <span class="ruby-keyword kw">do</span>
264:                         <span class="ruby-value str">'%'</span> <span class="ruby-operator">+</span> <span class="ruby-node">$1</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'H2'</span> * <span class="ruby-node">$1</span>.<span class="ruby-identifier">bytesize</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">'%'</span>).<span class="ruby-identifier">upcase</span>
265:                 <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-value str">' '</span>, <span class="ruby-value str">'+'</span>)
266:         <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

